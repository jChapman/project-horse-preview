"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[433],{3516:function(t,e,s){s.d(e,{Z:function(){return l}});var r=function(){var t=this,e=t._self._c;return"object"===typeof t.getDescription()?e("div",[e("ul",{staticClass:"text-left"},t._l(t.getDescription(),(function(s){return e("li",{key:s},[t._v(" "+t._s(s)+" ")])})),0)]):"string"===typeof t.getDescription()?e("div",[t._v(" "+t._s(t.getDescription())+" ")]):e("div",[t._v(t._s(t.getDescription()))])},i=[],a={props:{cosmetic:{}},methods:{getDescription(){return this.$i18n.t(`cosmetic_descriptions.${this.cosmetic.cosmetic_name}`)}}},o=a,c=s(1001),n=(0,c.Z)(o,r,i,!1,null,null,null),l=n.exports},9433:function(t,e,s){s.r(e),s.d(e,{default:function(){return f}});var r=function(){var t=this,e=t._self._c;return e("div",[e("h1",{directives:[{name:"t",rawName:"v-t",value:"store.checkout_title",expression:"'store.checkout_title'"}],staticClass:"page-title"}),e("div",{staticClass:"container text-center"},[e("b-alert",{attrs:{variant:"danger",dismissible:""},model:{value:t.showGeneralError,callback:function(e){t.showGeneralError=e},expression:"showGeneralError"}},[t._v(t._s(t.generalError))]),t._l(t.items,(function(s){return e("div",{key:s.cosmetic_id,staticClass:"item-card"},[e("div",{staticClass:"item-card-img"},[e("img",{staticClass:"preview-image",attrs:{src:t.cosmeticImageSrc(s),alt:s.cosmetic_name}})]),e("div",{staticClass:"item-card-body"},[e("div",{staticClass:"mb-2"},[t._v(" "+t._s(t.$t(`cosmetics.${s.cosmetic_name}`))+" ")]),e("CosmeticDescription",{staticClass:"mb-2 text-muted",attrs:{cosmetic:s}}),e("strong",[t._v("$"+t._s(s.cost_usd))])],1)])})),e("div",{staticClass:"item-card text-align-right"},[e("div",{staticClass:"item-card-body"},[0!=t.totalXp?e("div",{staticClass:"mb-2"},[e("span",{staticClass:"mr-2"},[t._v(t._s(t.$t("store.totalXp")))]),e("strong",[t._v(t._s(t.totalXp))])]):t._e(),e("div",[e("span",{staticClass:"mr-2"},[t._v(t._s(t.$t("store.subtotal")))]),e("strong",[t._v("$"+t._s(t.totalCost))])])])]),t.containsPurchasedBattlePass?[e("div",[t._v("You have already upgraded your battle pass!")])]:[t.loggedIn&&t.validPurchase?[t.loading?e("div",{staticClass:"d-flex justify-content-center mb-3"},[e("b-spinner",{attrs:{label:"Loading..."}})],1):e("b-card",{staticClass:"mt-3",staticStyle:{"max-width":"300px",margin:"auto"}},[e("StripePurchase",{staticClass:"my-3",attrs:{items:t.items},on:{purchaseSuccess:t.onPurchaseSuccess,error:t.onError}}),e("StripeAlipay",{staticClass:"mb-3",attrs:{items:t.items}}),e("StripeWeChatPay",{staticClass:"mb-3",attrs:{items:t.items}}),e("PaypalPurchase",{attrs:{items:t.items,paypalType:t.paypalType},on:{purchaseSuccess:t.onPurchaseSuccess,purchaseError:t.onError}}),e("b-alert",{attrs:{variant:"danger",dismissible:""},model:{value:t.showError,callback:function(e){t.showError=e},expression:"showError"}},[t._v(t._s(t.error))])],1)]:[t.validPurchase?[e("LoginButton",{staticClass:"mx-auto",staticStyle:{"max-width":"300px"}})]:t._e()]]],2),e("div",{staticClass:"text-center mt-4"},[e("b-button",{staticClass:"mx-auto",attrs:{to:"/store"}},[t._v(t._s(t.$t("store.back_to_store")))])],1)])},i=[],a=(s(7658),s(8828)),o=s(3516),c=s(2930),n=s(2474),l=function(){var t=this,e=t._self._c;return e("div",[e("b-button",{attrs:{variant:"primary",disabled:!t.complete},on:{click:t.goToWechat}},[t._v(t._s(t.$t("store.pay_with_wechat"))+" ")]),e("b-alert",{attrs:{variant:"danger",dismissible:""},model:{value:t.showError,callback:function(e){t.showError=e},expression:"showError"}},[t._v(t._s(t.error))])],1)},p=[],h={props:{items:[]},data:()=>({error:"",showError:!1,clientSecret:"",qrCodeUrl:"",paymentStatus:"",complete:!1,keys:{dev:"pk_test_kG4TReBTkO6yDfO9mMwtShME00mx65Yyw2",prod:"pk_live_FlJcVm7zuiGei0k6IDXksnmy003GNNZuiw"}}),created(){const t=!1,e=t?this.keys.dev:this.keys.prod,s=window.Stripe(e);this.stripe=s;const r=t?"http://localhost:8080":"https://abilityarena.com";let i=this.items.reduce(((t,e)=>t+100*e.cost_usd),0);i=Math.round(i);const a=this.$route.params.item_ids;s.createSource({type:"wechat",amount:i,currency:"usd",metadata:{cosmeticIDs:JSON.stringify(this.items.map((t=>t.cosmetic_id))),steamID:this.$store.state.auth.userSteamID},redirect:{return_url:`${r}/wechat_payment?item_id=${a}`}}).then((t=>{if(console.log(t),t.error)this.error=t.error.message,this.showError=!0;else{const e=t.source;this.clientSecret=e.client_secret,this.qrCodeUrl=e.wechat.qr_code_url,this.paymentStatus=e.status,this.complete=!0}}))},methods:{goToWechat(){window.location.href=this.qrCodeUrl}}},d=h,m=s(1001),u=(0,m.Z)(d,l,p,!1,null,null,null),y=u.exports,_=s(2122),v={components:{LoginButton:a.Z,CosmeticDescription:o.Z,PaypalPurchase:_.Z,StripePurchase:c.Z,StripeAlipay:n.Z,StripeWeChatPay:y},data(){return{items:[],error:"",showError:!1,showGeneralError:!1,generalError:"",loading:!0,validPurchase:!0}},computed:{loggedIn(){return this.$store.getters.loggedIn},bpUpgraded(){return this.$store.getters.bpUpgraded},paypalType(){const t=this.items.reduce(((t,e)=>t+e.cost_usd),0);return t<12?"cheap":"expensive"},totalCost(){return this.items.reduce(((t,e)=>t+e.cost_usd),0).toLocaleString()},totalXp(){return this.items.reduce(((t,e)=>{if(e.cosmetic_name.startsWith("buy_xp_")){const s=Number(e.cosmetic_name.slice(7));return t+s}return t}),0).toLocaleString()},containsPurchasedBattlePass(){return this.$store.getters.bpUpgraded&&this.items.some((t=>"buy_bp"===t.cosmetic_name))}},methods:{onPurchaseSuccess(){this.$router.push("/payment_success")},onError(t){this.error=t,this.showError=!0},cosmeticImageSrc(t){const{cosmetic_name:e}=t;return`/images/cosmetics/${e}.png`}},created(){const t=this.$route.params.item_ids.split("/");fetch("/api/cosmetics/get_cosmetics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cosmeticIDs:t})}).then((t=>t.json())).then((t=>{this.loading=!1,t.some((t=>t.cost_usd<=0))&&(this.generalError="Trying to purchase an invalid item (not purchaseable)",this.showGeneralError=!0,this.validPurchase=!1),t.some((t=>!t.cosmetic_id))&&(this.generalError="Invalid item(s)!",this.showGeneralError=!0,this.validPurchase=!1),this.items=t})).catch((()=>{this.error="Error loading cosmetic data",this.showError=!0,this.loading=!1}))}},g=v,w=(0,m.Z)(g,r,i,!1,null,"550d1db0",null),f=w.exports},2122:function(t,e,s){s.d(e,{Z:function(){return l}});var r=function(){var t=this,e=t._self._c;return e("div",[e("b-alert",{attrs:{variant:"danger",dismissible:""},model:{value:t.showError,callback:function(e){t.showError=e},expression:"showError"}},[t._v(t._s(t.error))]),e("b-alert",{attrs:{variant:"success",dismissible:""},model:{value:t.showSuccess,callback:function(e){t.showSuccess=e},expression:"showSuccess"}},[t._v(t._s(t.success))]),t.processingPayment?e("div",[t._v(" "+t._s(t.$t("store.processing"))+" "),t.loading?e("div",{staticClass:"d-flex justify-content-center mb-3"},[e("b-spinner",{attrs:{label:"Loading..."}})],1):t._e()]):e("div",{ref:"paypal",staticClass:"paypal-container"})],1)},i=[],a={props:{items:[],paypalType:String},data(){return{error:"",showError:!1,success:"",showSuccess:!1,processingPayment:!1,loading:!1,credentials:null,keys:{dev:{cheap:"AYAmQijTIaUAckei3KBH9rJh7Vea0lmIuUZclFx5RWUfhaG6OfcG7w_IOZclheI431gFF0ETdwfhnWbU",expensive:"AYAmQijTIaUAckei3KBH9rJh7Vea0lmIuUZclFx5RWUfhaG6OfcG7w_IOZclheI431gFF0ETdwfhnWbU"},prod:{cheap:"ARyCiFJGaPqBv5V0OJNPloAOgwUDp-YOu2cLtrp8fdTLlpBCaIfbXhnFHfVuMylXG9iyPaKCw2SR2D4V",expensive:"ARyCiFJGaPqBv5V0OJNPloAOgwUDp-YOu2cLtrp8fdTLlpBCaIfbXhnFHfVuMylXG9iyPaKCw2SR2D4V"}}}},mounted(){const t=!1;this.credentials=t?this.keys.dev:this.keys.prod;const e=document.createElement("script"),s="cheap"===this.paypalType?this.credentials.cheap:this.credentials.expensive;e.src=`https://www.paypal.com/sdk/js?client-id=${s}`,e.addEventListener("load",this.setLoaded),document.body.appendChild(e)},methods:{setLoaded(){const t=this.$store.state.auth.userSteamID,e=Math.round(100*this.items.reduce(((t,e)=>t+e.cost_usd),0))/100,s=this.paypalType,r=this;window.paypal.Buttons({style:{size:"small",color:"gold",shape:"pill",label:"checkout",layout:"horizontal"},createOrder:(t,s)=>s.order.create({purchase_units:[{amount:{currency_code:"USD",value:e}}],application_context:{shipping_preference:"NO_SHIPPING"}}),onApprove:e=>(r.processingPayment=!0,fetch(`/api/payments/paypal/${t}`,{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify({orderID:e.orderID,cosmeticIDs:this.items.map((t=>t.cosmetic_id)),paypalType:s})}).then((t=>t.json())).then((t=>{r.processingPayment=!1,"Payment Success"===t.message?(r.$store.dispatch("REFRESH_PLAYER"),r.$emit("purchaseSuccess")):(console.error(t.message),r.$emit("purchaseError",t.message))})).catch((t=>{r.processingPayment=!1,console.error(t),r.$emit("purchaseError",t)}))),onError:t=>{console.error(t),r.$emit("purchaseError",t)}}).render(this.$refs.paypal)}}},o=a,c=s(1001),n=(0,c.Z)(o,r,i,!1,null,"22459189",null),l=n.exports},2474:function(t,e,s){s.d(e,{Z:function(){return l}});var r=function(){var t=this,e=t._self._c;return e("div",[e("b-button",{attrs:{variant:"primary",disabled:!t.complete},on:{click:t.goToAlipay}},[t._v(t._s(t.$t("store.pay_with_alipay")))]),e("b-alert",{attrs:{variant:"danger",dismissible:""},model:{value:t.showError,callback:function(e){t.showError=e},expression:"showError"}},[t._v(t._s(t.error))])],1)},i=[],a={props:{items:[]},data:()=>({error:"",showError:!1,clientSecret:"",alipayRedirect:"",alipayStatus:"",complete:!1,keys:{dev:"pk_test_kG4TReBTkO6yDfO9mMwtShME00mx65Yyw2",prod:"pk_live_FlJcVm7zuiGei0k6IDXksnmy003GNNZuiw"}}),created(){const t=!1,e=t?this.keys.dev:this.keys.prod,s=window.Stripe(e);this.stripe=s;const r=t?"http://localhost:8080":"https://abilityarena.com";let i=this.items.reduce(((t,e)=>t+100*e.cost_usd),0);i=Math.round(i);const a=this.$route.params.item_ids;s.createSource({type:"alipay",amount:i,currency:"usd",metadata:{cosmeticIDs:JSON.stringify(this.items.map((t=>t.cosmetic_id))),steamID:this.$store.state.auth.userSteamID},redirect:{return_url:`${r}/alipay_payment?item_id=${a}`}}).then((t=>{if(t.error)this.error=t.error.message,this.showError=!0;else{const e=t.source;this.clientSecret=e.client_secret,this.alipayRedirect=e.redirect.url,this.alipayStatus=e.status,this.complete=!0}}))},methods:{goToAlipay(){window.location.href=this.alipayRedirect}}},o=a,c=s(1001),n=(0,c.Z)(o,r,i,!1,null,null,null),l=n.exports},2930:function(t,e,s){s.d(e,{Z:function(){return p}});var r=function(){var t=this,e=t._self._c;return e("div",[e("div",{ref:"card"}),e("b-button",{staticClass:"mt-3",attrs:{variant:"primary",disabled:!t.paymentIntent||!t.complete},on:{click:t.submitPayment}},[t._v(" "+t._s(t.$t("store.pay_with_stripe"))+" "),t.awaitingPayment?e("b-spinner",{attrs:{small:"",label:t.$t("store.loading")}}):t._e()],1)],1)},i=[];let a;var o={props:{items:[]},data:()=>({error:"",showError:!1,complete:!1,paymentIntent:!1,clientSecret:"",awaitingPayment:!1,keys:{dev:"pk_test_kG4TReBTkO6yDfO9mMwtShME00mx65Yyw2",prod:"pk_live_FlJcVm7zuiGei0k6IDXksnmy003GNNZuiw"}}),async created(){const t=!1,e=t?this.keys.dev:this.keys.prod,s=window.Stripe(e);this.stripe=s;const r=s.elements();this.paymentIntent=await this.createIntent(),this.clientSecret=this.paymentIntent.client_secret,this.createCardForm(r)},methods:{async createIntent(){const t="/api/payments/stripe/intents";let e=this.items.reduce(((t,e)=>t+100*e.cost_usd),0);e=Math.round(e);const s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e,cosmeticIDs:this.items.map((t=>t.cosmetic_id)),steamID:this.$store.state.auth.userSteamID})},r=await fetch(t,s);if(r.ok)return r.json();{const t=await r.json();this.$emit("error",t.message)}},createCardForm(t){a=t.create("card"),a.mount(this.$refs.card),a.on("change",(t=>this.complete=t.complete))},async submitPayment(){this.awaitingPayment=!0;const t=await this.stripe.handleCardPayment(this.clientSecret,a,{payment_method_data:{}});t.error?(console.error(t.error),this.$emit("error",t.error)):this.$emit("purchaseSuccess")}}},c=o,n=s(1001),l=(0,n.Z)(c,r,i,!1,null,null,null),p=l.exports}}]);
//# sourceMappingURL=433.f1b3cc03.js.map